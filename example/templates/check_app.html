<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"> 
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script> 
    <title>Document</title>
    <style>
        .bk{
            background-image: url("../static/images/bkg.jpg");
            background-size: 100% 100%;
            background-attachment: fixed;
        }

        .navbar {
            margin-bottom: 0;
            position: fixed;
            left: 0;
            right: 0;
        }

        .sidebar {
            left:0px;
            padding-top: 30px;
            padding: 0;
            position: fixed;
            top: 52px;
            bottom: 0;
            text-align: center;
            box-shadow: 3px 3px 3px rgba(170,170,170,0.3);
        }

        .content {
            position: fixed;
            top: 52px;
            right: 0;
            bottom: 0;
            overflow: scroll;
        }

        .active{
            background-color: #cccc99;
        }

        .myli{
            background-color: #CCFFFF;
        }
    </style>
</head>
<body class="bk">
    <div class="navbar  navbar-fixed-top" style="position: fixed;background:#66cccc ">
        <span style="display:inline-block">
        <a href="#" class="navbar-brand text-align='center'"><span font face="黑体" style="color:white ;">青年租房管理系统</span></a>
        </span>
        {% if kind == "guest" %}
                <span style="float:right; margin-top:8px">
                    <a href="../register"><button class="btn btn-default">注册</button></a>
                </span>
                <span style="float:right; margin-top:8px">
                    <a href="../login"><button class="btn btn-default">登录</button></a>
                </span>
            {% else %}
                <span style="float:right; margin-top:8px">
                    <a href="../logout"><button class="btn btn-default">退出</button></a>
                </span>
                <span style="float:right; margin-top:8px">
                    <a href="../show_info"><button class="btn btn-default">个人中心</button></a>
                </span>
                <span style="float:right; margin-top:0px">
                    <a href="#" class="navbar-brand text-align='center'">
                        <span font face="黑体" style="color:white ;">
                        {% if kind == "CS" %}
                            客服
                        {% endif %}
                        {% if kind == "user" %}
                            用户
                        {% endif %}
                        {% if kind == "tech" %}
                            维修人员
                        {% endif %}
                        ：{{ username }}
                        </span>
                    </a>
                </span>
            {% endif %}
    </div>
    <div class="container">
        <div class="row">
            <div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar collapse in" style="z-index:3">
                <ul class="nav menu list-group" style="background-color: green;" >
                    {% if kind == "CS" %}
                    <li class="myli list-group-item"><a href="../search_house"><span class="glyphicon glyphicon-home"></span>主页</a></li>
                    <li class="myli list-group-item"><a href="../show_info"><span class="glyphicon glyphicon-user"></span> 个人中心</a></li>
                    <li class="myli list-group-item"><a href="../add_technician"><span class="glyphicon glyphicon-plus"></span>添加工单师傅</a></li>
                    <li class="myli list-group-item"><a href="../add_house"><span class="glyphicon glyphicon-plus-sign"></span>添加房源</a></li>
                    <li class="myli list-group-item"><a href="../check_app"><span class="glyphicon glyphicon-eye-open"></span>审核租房申请</a></li>
                    <li class="myli list-group-item"><a href="../send_message"><span class="glyphicon glyphicon-envelope"></span>发送消息</a></li>
                    <li class="myli list-group-item"><a href="../create_apply"><span class="glyphicon glyphicon-bookmark"></span>创建租房订单</a></li>
                    <li class="myli list-group-item"><a href="../manage_repairing"><span class="glyphicon glyphicon-bell"></span>管理保修</a></li>
                    <li class="myli list-group-item"><a href="../manage_reporting"><span class="glyphicon glyphicon-bell"></span>管理投诉</a></li>
                    <li class="myli list-group-item"><a href="../check_user"><span class="glyphicon glyphicon-eye-open"></span>查看用户</a></li>
                    <li class="myli list-group-item"><a href="../change_title"><span class="glyphicon glyphicon-eye-open"></span>公告管理</a></li>
                    {% endif %}
                    {% if kind == "user" %}
                    <li class="myli list-group-item" ><a href="../search_house"><span class="glyphicon glyphicon-home"></span>主页</a></li>
                    <li class="myli list-group-item"><a href="../show_info"><span class="glyphicon glyphicon-user"></span> 个人中心</a></li>
                    <li class="myli list-group-item"><a href="../my_app"><span class="glyphicon glyphicon-flag"></span>我的租房申请</a></li>
                    <li class="myli list-group-item"><a href="../my_message"><span class="glyphicon glyphicon-comment"></span>我的消息{{ unread }}</a></li>
                    <li class="myli list-group-item"><a href="../my_repairing"><span class="glyphicon glyphicon-tower"></span>我的报修</a></li>
                    <li class="myli list-group-item"><a href="../my_reporting"><span class="glyphicon glyphicon-tower"></span>我的投诉</a></li>
                    {% endif %}
                    {% if kind == "tech" %}
                    <li class="myli list-group-item"><a href="../search_house"><span class="glyphicon glyphicon-home"></span>主页</a></li>
                    <li class="myli list-group-item"><a href="../my_repairing"><span class="glyphicon glyphicon-tower"></span>我的工单</a></li>
                    <li class="myli list-group-item"><a href="../show_info"><span class="glyphicon glyphicon-user"></span> 个人中心</a></li>
                    {% endif %}
                </ul>
                <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="80%" color=#987cb9 SIZE=3>
            </div>
            <div class="col-md-10 content pull-right" style="margin-top: 50px;">
                <form action="/check_app/" method="post" role="form">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <label>搜索申请ID</label><br>
                            <input type="text" name="apply_id" class ="form-control"/>
                            <br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <label>搜索用户名</label><br>
                            <input type="text" name="username" class ="form-control"/>
                            <br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <label>搜索房源ID</label><br>
                            <input type="text" name="house_id" class ="form-control"/>
                            <br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <label>查看未被审核的</label><br>
                            <input type="radio" name="not_allowed"/>
                            <br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <button type="submit"  class="btn btn-default">提交</button>
                            <br/>
                        </div>
                    </div>
                </form>
                <form action="/remind/" method="post">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6 col-md-offset-2 form-group">
                            <button type="submit"  class="btn btn-default">自动提醒缴费</button>
                            <br/>
                        </div>
                    </div>
                </form>
                <br/>
                <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                <div style="width: 80%; margin-left: 10% ;">
                    {% if apps %}
                    <caption><h3>待审核订单列表</h3></caption>
                    <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                {% for app in apps %}
                    {% if app.is_allowed == False %}
                <table class="table table-bordered">
                   <thead>
                      <tr>
                         <th>申请ID</th>
                         <th>用户名</th>
                         <th>房屋ID</th>
                         <th>是否通过审核</th>
                          {% if app.is_allowed %}
                            <th>订单审核人</th>
                            {% endif %}
                         <th>是否支付</th>
                         <th>租房类型</th>
                         <th>起始日期</th>
                         <th>租房时长</th>
                          {% if app.is_allowed %}
                            {% if app.is_paid %}
                                <th colspan="1" style="text-align: center;">选择操作</th>
                            {% else %}
                                <th colspan="2" style="text-align: center;">选择操作</th>
                            {% endif %}
                          {% else %}
                            <th colspan="2" style="text-align: center;">选择操作</th>
                          {% endif %}
                      </tr>
                   </thead>
                   <tbody>
                      <tr>
                        <td>{{ app.apply_id }} </td>
                        <td>{{ app.username }} </td>
                        <td>{{ app.house_id }} </td>
                        <td>
                            {% if app.is_allowed %}
                                已通过审核
                            {% else %}
                                未通过审核
                            {% endif %}
                        </td>
                          {% if app.is_allowed %}
                            <td>{{ app.allowed_by }} </td>
                        {% endif %}
                        <td>
                            {% if app.is_paid %}
                                已支付
                            {% else %}
                                未支付
                            {% endif %}
                        </td>
                        <td>
                            {% if app.rent_type == "long" %}
                                长租
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                短租
                            {% endif %}
                        </td>
                        <td>{{ app.s_y }}年{{ app.s_m }}月{{ app.s_d }}日</td>
                        <td>
                            {{ app.duration }}
                            {% if app.rent_type == "long" %}
                                月
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                天
                            {% endif %}
                        </td>
                          {% if app.is_allowed == False %}
                        <td>
                            <form action="/user_info/" method="post">
                                {% csrf_token %}
                                <input name="user_name" type="hidden" value="{{app.username}}"/>
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >查看客户信息</button>
                            </form>
                        </td>
                          {% endif %}
                          {% if app.is_allowed %}
                          {% if app.is_paid == False %}
                        <td>
                            <form action="/confirm_payment/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >确认支付成功</button>
                            </form>
                        </td>
                          {% endif %}
                          {% endif %}
                        <td>
                            <form action="/cancel_apply/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default">拒绝订单</button>
                            </form>
                        </td>

                      </tr>


                   </tbody>
                </table>
                    {% endif %}
                {% endfor %}
                    <br>
                    <caption><h3>已审核未支付订单列表</h3></caption>
                    <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                    {% for app in apps %}
                    {% if app.is_allowed %}
                    {% if app.is_paid == False %}
                <table class="table table-bordered">
                   <thead>
                      <tr>
                         <th>申请ID</th>
                         <th>用户名</th>
                         <th>房屋ID</th>
                         <th>是否通过审核</th>
                          {% if app.is_allowed %}
                            <th>订单审核人</th>
                            {% endif %}
                         <th>是否支付</th>
                         <th>租房类型</th>
                         <th>起始日期</th>
                         <th>租房时长</th>
                          {% if app.is_allowed %}
                            {% if app.is_paid %}
                                <th colspan="1" style="text-align: center;">选择操作</th>
                            {% else %}
                                <th colspan="2" style="text-align: center;">选择操作</th>
                            {% endif %}
                          {% else %}
                            <th colspan="2" style="text-align: center;">选择操作</th>
                          {% endif %}
                      </tr>
                   </thead>
                   <tbody>
                      <tr>
                        <td>{{ app.apply_id }} </td>
                        <td>{{ app.username }} </td>
                        <td>{{ app.house_id }} </td>
                        <td>
                            {% if app.is_allowed %}
                                已通过审核
                            {% else %}
                                未通过审核
                            {% endif %}
                        </td>
                          {% if app.is_allowed %}
                            <td>{{ app.allowed_by }} </td>
                        {% endif %}
                        <td>
                            {% if app.is_paid %}
                                已支付
                            {% else %}
                                未支付
                            {% endif %}
                        </td>
                        <td>
                            {% if app.rent_type == "long" %}
                                长租
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                短租
                            {% endif %}
                        </td>
                        <td>{{ app.s_y }}年{{ app.s_m }}月{{ app.s_d }}日</td>
                        <td>
                            {{ app.duration }}
                            {% if app.rent_type == "long" %}
                                月
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                天
                            {% endif %}
                        </td>
                          {% if app.is_allowed == False %}
                        <td>
                            <form action="/user_info/" method="post">
                                {% csrf_token %}
                                <input name="user_name" type="hidden" value="{{app.username}}"/>
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >查看客户信息</button>
                            </form>
                        </td>
                          {% endif %}
                          {% if app.is_allowed %}
                          {% if app.is_paid == False %}
                        <td>
                            <form action="/confirm_payment/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >确认支付成功</button>
                            </form>
                        </td>
                          {% endif %}
                          {% endif %}
                        <td>
                            <form action="/cancel_apply/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default">拒绝订单</button>
                            </form>
                        </td>

                      </tr>

                   </tbody>
                </table>
                    {% endif %}
                    {% endif %}
                {% endfor %}
                    <br>
                    <caption><h3>已支付订单列表</h3></caption>
                    <HR style="FILTER: alpha(opacity=100,finishopacity=0,style=3)" width="100%" color=#987cb9 SIZE=3>
                    {% for app in apps %}
                    {% if app.is_allowed %}
                    {% if app.is_paid %}
                <table class="table table-bordered">
                   <thead>
                      <tr>
                         <th>申请ID</th>
                         <th>用户名</th>
                         <th>房屋ID</th>
                         <th>是否通过审核</th>
                          {% if app.is_allowed %}
                            <th>订单审核人</th>
                            {% endif %}
                         <th>是否支付</th>
                         <th>租房类型</th>
                         <th>起始日期</th>
                         <th>租房时长</th>
                          {% if app.is_allowed %}
                            {% if app.is_paid %}
                                <th colspan="1" style="text-align: center;">选择操作</th>
                            {% else %}
                                <th colspan="2" style="text-align: center;">选择操作</th>
                            {% endif %}
                          {% else %}
                            <th colspan="2" style="text-align: center;">选择操作</th>
                          {% endif %}
                      </tr>
                   </thead>
                   <tbody>
                      <tr>
                        <td>{{ app.apply_id }} </td>
                        <td>{{ app.username }} </td>
                        <td>{{ app.house_id }} </td>
                        <td>
                            {% if app.is_allowed %}
                                已通过审核
                            {% else %}
                                未通过审核
                            {% endif %}
                        </td>
                          {% if app.is_allowed %}
                            <td>{{ app.allowed_by }} </td>
                        {% endif %}
                        <td>
                            {% if app.is_paid %}
                                已支付
                            {% else %}
                                未支付
                            {% endif %}
                        </td>
                        <td>
                            {% if app.rent_type == "long" %}
                                长租
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                短租
                            {% endif %}
                        </td>
                        <td>{{ app.s_y }}年{{ app.s_m }}月{{ app.s_d }}日</td>
                        <td>
                            {{ app.duration }}
                            {% if app.rent_type == "long" %}
                                月
                            {% endif %}
                            {% if app.rent_type == "short" %}
                                天
                            {% endif %}
                        </td>
                          {% if app.is_allowed == False %}
                        <td>
                            <form action="/user_info/" method="post">
                                {% csrf_token %}
                                <input name="user_name" type="hidden" value="{{app.username}}"/>
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >查看客户信息</button>
                            </form>
                        </td>
                          {% endif %}
                          {% if app.is_allowed %}
                          {% if app.is_paid == False %}
                        <td>
                            <form action="/confirm_payment/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default" >确认支付成功</button>
                            </form>
                        </td>
                          {% endif %}
                          {% endif %}
                        <td>
                            <form action="/cancel_apply/" method="post">
                                {% csrf_token %}
                                <input name="apply_id" type="hidden" value="{{app.apply_id}}"/>
                                <button type="submit"  class="btn btn-default">拒绝订单</button>
                            </form>
                        </td>

                      </tr>

                   </tbody>
                </table>
                    {% endif %}
                    {% endif %}
                {% endfor %}
                {% endif %}
                {% if message %}
                <script type="text/javascript">
                    alert("{{ message }}");
                </script>
                {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html>